# 机器人表情映射项目：演示与全流程操作手册 (Walkthrough & Manual)

欢迎来到“机器人表情映射”项目。本项目旨在演示如何通过 MLOps（机器学习运维）流程，将直播文案转化为机器人自然的发音表情。本手册将从“快速体验”和“深度开发”两个视角为您提供指引。

---

## 🚀 1. 快速体验视角 (面向零基础用户)

如果您只想快速看到机器人的表情效果，请按照以下步骤操作：

### 1.1 启动可视化模拟器
> [!WARNING]
> **注意**：由于浏览器安全限制 (CORS)，直接双击打开 HTML 可能无法加载预测数据。请使用以下方式启动：

1.  在项目根目录下打开终端。
2.  运行本地服务器指令：
    ```powershell
    c:\work\code\face\venv_310\Scripts\python.exe -m http.server 8000
    ```
3.  在浏览器访问：[http://localhost:8000/src/simulator/](http://localhost:8000/src/simulator/)
4.  **操作建议**：
    *   点击 **“运行内置演示”**：观看机器人预设的一段流畅表情动画。
    *   点击 **“加载最新预测序列 (JSON)”**：模拟器会自动通过 HTTP 请求读取训练管道产出的最新结果 `data/output/prediction.json`。
4.  **观察点**：注意机器人眼球在不同情感（如惊讶时上挑）的变化，以及嘴部随着“字符”产生的张合动作。

---

## 🛠️ 2. 开发者视角 (面向技术维护人员)

如果您需要重新运行模型、生成新数据或调整参数，请参考本节。

### 2.1 运行环境初始化
为了避免 Windows 下的路径问题，请使用我们为您搭建好的 Python 3.10 环境：
```powershell
# 使用绝对路径运行（推荐）
c:\work\code\face\venv_310\Scripts\python.exe --version
```

### 2.2 第一步：生成模拟训练数据
模型需要“语料”来学习表情规律。
```powershell
# 运行脚本生成 2000 条句子及其表情标注
c:\work\code\face\venv_310\Scripts\python.exe scripts/generate_dataset_v2.py
```
*   **产出物**：`data/raw/training_data.csv`
*   **作用**：它模拟了机器人直播时的不同情绪话术。

### 2.3 第二步：启动 MLOps 训练管道
使用 ZenML 自动执行从加载数据到训练模型的全过程。
```powershell
# 启动自动化管道
$env:PYTHONPATH = "c:\work\code\face"
c:\work\code\face\venv_310\Scripts\python.exe pipelines/robot_pipeline.py
```
*   **查看进度**：您会看到终端出现绿色进度条，依次执行 `loader -> trainer -> evaluator`。
*   **最终产出**：它会自动更新 `data/output/prediction.json`，供模拟器读取。

### 2.4 第三步：监控实验指标
通过 MLflow 查看模型的“考试成绩”。
```powershell
# 启动监控界面
c:\work\code\face\venv_310\Scripts\mlflow.exe ui
```
*   **查看方式**：浏览器访问 `http://127.0.0.1:5000`。
*   **核心指标**：查看 `test_mse`。数值越小，代表机器人的表情动作预测越精准。

---

## 🧠 3. 原理深度解析

### 3.1 文本如何变成动作？
1.  **分词与特征提取**：模型识别出“惊讶”等关键词。
2.  **回归预测**：模型输出三个数字（Mouth, Eye, Lid）。
3.  **动作整形**：
    *   **平滑**：应用低通滤波，消除机械的“瞬移”感。
    *   **量化**：将小数四舍五入为电机可识别的 1-5 档位。

### 3.2 局限性说明
*   **数据性**：目前使用的是模拟合成数据，未来接入真实传感器（sEMG）数据后，表情会更加细腻。
*   **同步性**：目前采用字符级停顿，未来将接入 TTS 的毫秒级时间戳实现精准对齐。

---

## 🔧 4. 常见问题排查 (Troubleshooting)

| 现象 | 可能原因 | 解决方法 |
| :--- | :--- | :--- |
| **找不到路径** | 命令行相对路径错误 | 请始终参考 2.1 节，使用 **绝对路径** 执行 python。 |
| **ZenML 报错** | 数据库未初始化 | 运行 `c:\work\code\face\venv_310\Scripts\zenml.exe init`。 |
| **模拟器无反应** | `prediction.json` 损坏 | 检查该文件格式是否为合法的 JSON 数组，或重新运行管道。 |

---

## 5. MLOps 工具利用率评估

目前的实现已经完成了这三款工具的**核心闭环 (Core Pillars)**，但根据工业化标准，仍有进一步深化的空间：

### 5.1 DVC (数据版本管理)
- **当前程度**：[70%] 已实现对原始 CSV 的版本追踪和备份。
- **提升空间**：未来应将模型文件 (`.joblib`) 也纳入 DVC 管理，并配置远端存储（如 S3 或 阿里云 OSS），实现多人协作下的数据/模型同步。

### 5.2 ZenML (管道编排)
- **当前程度**：[80%] 已将整个逻辑拆解为标准的 `loader -> trainer -> evaluator` 三步走。
- **提升空间**：目前使用的是默认本地堆栈。未来可以将其部署到 Kubernetes 上，并增加“条件触发”逻辑（例如：只有当新数据的回流达到一定量级时才自动触发重训）。

### 5.3 MLflow (实验跟踪)
- **当前程度**：[50%] 已集成 UI 查看功能，并在控制台打印了指标。
- **提升空间**：**最显著的提升点**。目前指标仅为控制台 `print`，后续应在 `trainer` 步骤中增加 `@enable_mlflow` 装饰器，实现 MSE 曲线在 MLflow 页面上的自动绘图和模型部署管理 (Model Registry)。

---
> [!IMPORTANT]
> **综合评价**：本项目目前的实现属于 **“轻量化生产级”**，非常适合 PoC（概念验证）和快速迭代。它确保了实验的**可复现性**，为后续的深度自动化打下了完美的架构基础。
